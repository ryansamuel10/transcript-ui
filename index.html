<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Global Word Cloud – All Interactions</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
background: radial-gradient(circle at top left, #1e293b, #020617);
color: #e5e7eb;
font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
padding: 20px;
}
.container {
max-width: 1200px;
margin: auto;
background: rgba(15,23,42,0.94);
border-radius: 20px;
padding: 24px 28px;
box-shadow: 0 30px 80px rgba(0,0,0,0.7);
border: 1px solid rgba(148,163,184,0.4);
backdrop-filter: blur(14px);
}
h1 {
margin-bottom: 6px;
font-size: 1.9rem;
}
.subtitle {
color: #94a3b8;
margin-bottom: 20px;
font-size: .9rem;
}
.search {
display: flex;
gap: 10px;
margin-bottom: 20px;
}
.search input {
flex: 1;
padding: 10px 12px;
border-radius: 999px;
background: #020617;
border: 1px solid #334155;
color: #fff;
}
.search input:focus {
outline: none;
border-color: #60a5fa;
box-shadow: 0 0 0 1px #3b82f6;
}
.search button {
padding: 10px 18px;
border-radius: 999px;
border: none;
cursor: pointer;
background: linear-gradient(135deg, #2563eb, #22c55e);
color: white;
font-weight: 600;
transition: 0.2s;
}
.search button:hover {
transform: translateY(-1px);
filter: brightness(1.1);
box-shadow: 0 10px 20px rgba(37,99,235,0.5);
}
#wordCloud {
margin-top: 16px;
text-align: center;
min-height: 420px;
}
.word {
display: inline-block;
margin: 6px 8px;
cursor: pointer;
transition: .12s;
}
.word:hover {
transform: scale(1.15);
filter: brightness(1.3);
text-shadow: 0 0 14px rgba(59,130,246,0.9);
}
.active {
background: #22c55e;
color: #022c22 !important;
padding: 2px 9px;
border-radius: 12px;
box-shadow: 0 0 10px rgba(34,197,94,0.7);
}
.panel {
padding: 14px;
margin-top: 20px;
background: rgba(15,23,42,0.94);
border-radius: 14px;
border: 1px solid #334155;
}
table {
width: 100%;
margin-top: 6px;
border-spacing: 0 4px;
font-size: .82rem;
}
td {
padding: 6px;
}
.idCell {
font-family: monospace;
color: #cbd5e1;
}
.countCell {
text-align: right;
font-family: monospace;
}
</style>
</head>

<body>
<div class="container">
<h1>Global Word Cloud</h1>
<div class="subtitle">
One cloud built from ALL interactions combined. Bigger words = used more often.
</div>

<div class="search">
<input id="searchBox" type="text" placeholder="Search a word...">
<button onclick="searchWord()">Search</button>
</div>

<div id="wordCloud">Loading...</div>

<div id="results" class="panel" style="display:none;"></div>

<div class="panel" style="margin-top:16px;">
  <h2 style="margin:0 0 10px 0;">Transcript Viewer</h2>

  <div class="search" style="margin-bottom:10px;">
    <select id="interactionSelect" style="flex:1; padding:10px 12px; border-radius:999px; background:#020617; border:1px solid #334155; color:#fff;">
      <option value="">Select an interaction...</option>
    </select>
    <button onclick="showSelectedTranscript()">View</button>
  </div>

  <pre id="transcriptBox" style="white-space:pre-wrap; background:#020617; border:1px solid #334155; border-radius:14px; padding:12px; min-height:140px; color:#e5e7eb; margin:0;"></pre>
</div>

</div>

<script>
const ENDPOINT = "https://698cc16821a248a273628479.mockapi.io/api/storage/interactions";

let interactions = []; // { id, transcript, createdAt }
let globalFreq = {}; // word → total count
let perInteractionFreq = {}; // word → { interactionId → count }

const STOPWORDS = new Set([
"the","and","or","a","an","of","to","in","it","is","for","on","that","this","with",
"you","i","we","they","he","she","be","are","was","were","at","by","as","from",
"about","so","if","but","not","just","can","could","should","would","will","your",
"our","their","them","me","my","us","do","did","done","have","has","had","there",
"then","than","when","what","which","who","how","why","up","down","out","in","all"
]);

function cleanWords(text) {
  // remove timestamps like 00:12 or 01:02:33
  text = text.replace(/\b\d{1,2}:\d{2}(:\d{2})?\b/g, " ");

  const words = text.toLowerCase().match(/\b[\p{L}\p{N}']+\b/gu) || [];

  return words.filter(w => {
    if (STOPWORDS.has(w)) return false;

    // remove pure numbers
    if (/^\d+$/.test(w)) return false;

    // remove anything containing digits (phone numbers, IDs)
    if (/\d/.test(w)) return false;

    // remove very short tokens
    if (w.length < 3) return false;

    // remove long hex-like strings (UUID fragments)
    if (/^[0-9a-f]{6,}$/.test(w)) return false;

    return true;
  });
}

function populateInteractionDropdown() {
  const sel = document.getElementById("interactionSelect");
  if (!sel) return;

  sel.innerHTML = `<option value="">Select an interaction...</option>`;

  // newest first if createdAt exists
  const sorted = [...interactions].sort((a, b) => {
    const da = Date.parse(a.createdAt || "") || 0;
    const db = Date.parse(b.createdAt || "") || 0;
    return db - da;
  });

  sorted.forEach(i => {
    const opt = document.createElement("option");
    opt.value = i.id;
    opt.textContent = i.id;
    sel.appendChild(opt);
  });
}

function showSelectedTranscript() {
  const sel = document.getElementById("interactionSelect");
  const box = document.getElementById("transcriptBox");
  if (!sel || !box) return;


::contentReference[oaicite:0]{index=0}